<technique name="skybox" version="100">
	<pass name="pass0">
		<uniforms>
			<var name="transform.projectionMatrix" type="mat4" val="transform.projectionMatrix"/>
			<var name="transform.modelMatrix" type="mat4" val="transform.modelMatrix"/>
			<var name="transform.viewMatrix" type="mat4" val="transform.viewMatrix"/>
            <var name="transform.viewPosition" type="vec3" val="transform.viewPosition"/>
		</uniforms>
		<attributes>
			<var name="positions" type="vec3" val="mesh.positions"/>
            <var name="texture0" type="vec2" val="mesh.texture0"/>
		</attributes>
		<samplers> 
            <var name="sampler0"/>
		</samplers>
		<renderstate polygonmode="fill" winding="cw" cullface="false"/>
		<rendertarget val="default"/>
		<shaders>
			<var type="vertex" name="vskybox">
				<![CDATA[
					#version 330
                    
					#define POSITION 	0
                    #define NORMAL 		2
					#define TEXCOORD0 	5

					layout (location = POSITION) in vec3 positions;
                    layout (location = TEXCOORD0) in vec2 texture0;

					struct Transform
					{
						mat4 projectionMatrix;
						mat4 modelMatrix;
						mat4 viewMatrix;
                        vec3 viewPosition;
					};
					uniform Transform transform;
                    
                    struct Vertex 
					{
						vec2  texCoord0;
					};
                    out Vertex fragVertex;

					void main()
					{
                        fragVertex.texCoord0 = texture0;
                        
                        mat4 skypos = transform.modelMatrix;
                        skypos[3].xyz = transform.viewPosition;
                        
                        vec4 vertex = skypos * vec4(positions, 1.0);
                        gl_Position = transform.projectionMatrix * transform.viewMatrix * vertex;
					}
				]]>
			</var>
			<var type="fragment" name="fskybox">
				<![CDATA[
					#version 330

					uniform sampler2D sampler0;

					struct Vertex 
					{
						vec2  texCoord0;
					};

					in 	Vertex 	fragVertex;
					out vec4 	fragColor;

					void main()
					{
						fragColor = texture(sampler0, fragVertex.texCoord0);
					}
				]]>
			</var>
		</shaders>
	</pass>
</technique>
